#ifndef FIDUCIAL_H
#define FIDUCIAL_H

#include <TVectorT.h>
#include <TVector3.h>
#include <TF1.h>
#include <TGraph.h>
#include <TCanvas.h>
#include <TLorentzVector.h>
#include <iostream>
#include <fstream>
#include <iomanip>
#include <vector>



struct Fiducial {

  void SetConstants(int in_TorusCurrent, std::string in_target_name, std::map<std::string,double> in_en_beam, std::map<std::string,double> en_beam_Ecal, std::map<std::string,double> en_beam_Eqe);
  void SetFiducialCutParameters(std::string beam_en);
  Bool_t GetEPhiLimits(std::string beam_en, Float_t momentum, Float_t theta, Int_t sector,Float_t *EPhiMin, Float_t *EPhiMax);
  Bool_t EFiducialCut(std::string beam_en, TVector3 momentum);
  Bool_t PFiducialCut(std::string beam_en, TVector3 momentum);
  Bool_t PiplFiducialCut(std::string beam_en, TVector3 momentum,Float_t *philow,Float_t *phiup);
  Bool_t PimiFiducialCut(std::string beam_en, TVector3 momentum, Float_t *pimi_philow, Float_t *pimi_phiup);
  bool Phot_fid(TVector3 V3_phot);
  bool Pi_phot_fid_united(std::string beam_en, TVector3 V3_pi_phot, int q_pi_phot);

  int fTorusCurrent;
  std::string target_name;
  std::map<std::string,double> en_beam;
  std::map<std::string,double> en_beam_Ecal;
  std::map<std::string,double> en_beam_Eqe;

  TF1 *up_lim1_ec, *up_lim2_ec,*up_lim3_ec,*up_lim4_ec, *up_lim5_ec,*up_lim6_ec,*low_lim1_ec,*low_lim2_ec,*low_lim3_ec, *low_lim4_ec,*low_lim5_ec,*low_lim6_ec;
	TF1 *leftside_lim1_ec, *leftside_lim2_ec,*leftside_lim3_ec, *leftside_lim4_ec,*leftside_lim5_ec, *leftside_lim6_ec,*rightside_lim1_ec, *rightside_lim2_ec,*rightside_lim3_ec, *rightside_lim4_ec,*rightside_lim5_ec, *rightside_lim6_ec;

  //4.4 GeV parameters
  //e- parameters
  Float_t fgPar_4Gev_2250_Efid_t0_p[6][2];// 4GeV e- fiducial cut parameters
  Float_t fgPar_4Gev_2250_Efid_t1_p[6][6];
  Float_t fgPar_4Gev_2250_Efid_b_p[6][2][6];
  Float_t fgPar_4Gev_2250_Efid_a_p[6][2][6];
  Float_t fgPar_4Gev_2250_Efid_Theta_S5_extra[8][4];
  Float_t fgPar_4Gev_2250_Efid_Theta_S4_extra[2][4];
  Float_t fgPar_4Gev_2250_Efid_Theta_S3_extra[4][4];
  Float_t fgPar_4Gev_2250_Efid_Theta_S5[8][8];
  Float_t fgPar_4Gev_2250_Efid_Theta_S4[2][8];
  Float_t fgPar_4Gev_2250_Efid_Theta_S3[4][8];
  //proton parameter
  Float_t fgPar_4Gev_2250_Pfid_ScpdS2[2][6];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS3[8][6];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS4[4][6];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS5[8][6];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS2_extra[2][4];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS3_extra[8][4];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS4_extra[4][4];
  Float_t fgPar_4Gev_2250_Pfid_ScpdS5_extra[8][4];
  Float_t fgPar_4Gev_2250_Pfidft1l[6][6];
  Float_t fgPar_4Gev_2250_Pfidft1r[6][6];
  Float_t fgPar_4Gev_2250_Pfidft2l[6][6];
  Float_t fgPar_4Gev_2250_Pfidft2r[6][6];
  Float_t fgPar_4Gev_2250_Pfidbt1l[6][6];
  Float_t fgPar_4Gev_2250_Pfidbt1r[6][6];
  Float_t fgPar_4Gev_2250_Pfidbt2l[6][6];
  Float_t fgPar_4Gev_2250_Pfidbt2r[6][6];
  Float_t fgPar_4Gev_2250_Pfidbl[6][6];
  Float_t fgPar_4Gev_2250_Pfidbr[6][6];

  //1.1 GeV parameters
   //electron parameters
  double fgPar_1gev_750_Efid[6][5][6];
  double fgPar_1gev_750_Efid_Theta_S3[4][8];
  double fgPar_1gev_750_Efid_Theta_S4[2][8];
  double fgPar_1gev_750_Efid_Theta_S5[8][8];
  double fgPar_1gev_1500_Efid[6][5][6];
  double fgPar_1gev_1500_Efid_Theta_S3[4][8];
  double fgPar_1gev_1500_Efid_Theta_S4[2][8];
  double fgPar_1gev_1500_Efid_Theta_S5[8][8];

  //proton parameters
  double fgPar_1gev_750_Pfid[6][5][6];
  double fgPar_1gev_750_Pfid_ScpdS2[2][6];
  double fgPar_1gev_750_Pfid_ScpdS3[8][6];
  double fgPar_1gev_750_Pfid_ScpdS4[4][6];
  double fgPar_1gev_750_Pfid_ScpdS5[8][6];
  double fgPar_1gev_1500_Pfid[6][5][6];
  double fgPar_1gev_1500_Pfid_ScpdS2[2][6];
  double fgPar_1gev_1500_Pfid_ScpdS3[8][6];
  double fgPar_1gev_1500_Pfid_ScpdS4[4][6];
  double fgPar_1gev_1500_Pfid_ScpdS5[8][6];

  //Pion Plus parameter?
  double fgPar_1gev_750_Piplfid[6][5][6];
  double fgPar_1gev_750_Piplfid_ScpdS2[2][6];
  double fgPar_1gev_750_Piplfid_ScpdS3[8][6];
  double fgPar_1gev_750_Piplfid_ScpdS4[4][6];
  double fgPar_1gev_750_Piplfid_ScpdS5[8][6];
  double fgPar_1gev_1500_Piplfid[6][5][6];
  double fgPar_1gev_1500_Piplfid_ScpdS2[2][6];
  double fgPar_1gev_1500_Piplfid_ScpdS3[8][6];
  double fgPar_1gev_1500_Piplfid_ScpdS4[4][6];
  double fgPar_1gev_1500_Piplfid_ScpdS5[8][6];

  //Pion Minus parameter?
  double fgPar_1gev_750_Pimfid[6][5][6];
  double fgPar_1gev_750_Pimfid_Theta_S3[4][8];
  double fgPar_1gev_750_Pimfid_Theta_S4[2][8];
  double fgPar_1gev_750_Pimfid_Theta_S5[8][8];
  double fgPar_1gev_750_Pimfid_Theta_S3_extra[4][4];
  double fgPar_1gev_750_Pimfid_Theta_S4_extra[2][4];
  double fgPar_1gev_750_Pimfid_Theta_S5_extra[8][4];
  double fgPar_1gev_1500_Pimfid[6][5][6];
  double fgPar_1gev_1500_Pimfid_Theta_S3[4][8];
  double fgPar_1gev_1500_Pimfid_Theta_S4[2][8];
  double fgPar_1gev_1500_Pimfid_Theta_S5[8][8];
  double fgPar_1gev_1500_Pimfid_Theta_S3_extra[4][4];
  double fgPar_1gev_1500_Pimfid_Theta_S4_extra[2][4];
  double fgPar_1gev_1500_Pimfid_Theta_S5_extra[8][4];

//2.2 GeV parameters
  const Float_t fgPar_2GeV_2250_Efid[6][6][9] = {{
              {62.2935, -92.5133, 87.0360, -38.4696, 6.3177, 0, 0, 0, 0},
              {78.5134, -58.5975, 3.30928, 77.4749, -64.3984, 14.4860, 0, 0, 0},
              {-140.845, 1381.30, -4499.99, 7557.27, -7140.27, 3828.75, -1086.21, 126.468, 0},
              {497.951, -1846.42, 2759.58, -1634.71, 345.006, 0, 0, 0, 0},
              {9.40986, 180.752, -646.771, 1055.14, -909.094, 424.435, -99.8368, 9.02086, 0},
              {288.485, -1016.03, 1463.72, -859.231, 185.976, 0, 0, 0, 0}},
                   {{61.1474, -88.768, 82.6446, -36.2780, 5.92310, 0, 0, 0, 0},
              {78.5134, -58.5975, 3.30928, 77.4749, -64.3984, 14.4860, 0, 0, 0},
              {21.3087, 138.975, -672.710, 1324.20, -1326.12, 714.866, -197.531, 21.9144, 0},
              {375.091, -1411.50, 2082.58, -1192.17, 239.685, 0, 0, 0, 0},
              {-121.816, 1182.59, -3800.98, 6319.82, -5937.33, 3179.37, -903.954, 105.764, 0},
              {-4781.96, 43165.9, -159567, 318502, -376469, 271207, -116893, 27698.9, -2775.61}},
                 {{61.1474, -88.7680, 82.6446, -36.2780, 5.92310, 0, 0, 0, 0},
              {73.7620, -34.6321, -41.8796, 117.543, -81.2043, 17.1718, 0, 0, 0},
              {157.046, -765.472, 1735.21, -2053.86, 1371.34, -515.214, 101.081, -8.07402, 0},
              {-608.740, 4827.18, -13239.6, 17742.4, -12420.0, 4369.11, -607.877, 0, 0},
              {-274.278, 2380.63, -7560.19, 12582.3, -11924.5, 6464.66, -1863.44, 221.134, 0},
              {-1240.72, 8096.04, -19407.0, 23942.9, -16052.3, 5559.32, -776.123, 0, 0}},
                 {{61.1474, -88.7680, 82.6446, -36.2780, 5.92310, 0, 0, 0, 0},
              {78.5134, -58.5975, 3.30928, 77.4749, -64.3984, 14.4860, 0, 0, 0},
              {-71.2528, 879.668, -3027.37, 5226.61, -4999.19, 2689.35, -761.206, 88.1242, 0},
              {-1269.89, 9486.25, -26103.8, 35581.2, -25373.0, 9062.87, -1277.60, 0, 0},
              {-186.640, 1811.85, -6032.01, 10283.3, -9808.11, 5285.35, -1501.87, 174.799, 0},
              {-530.826, 4643.56, -13864.2, 20580.2, -15898.0, 6106.69, -916.365, 0, 0}},
                 {{61.6665, -90.4268, 84.5606, -37.2240, 6.09207, 0, 0, 0, 0},
              {78.5134, -58.5975, 3.30928, 77.4749, -64.3984, 14.4860, 0, 0, 0},
              {-1.53910, 216.936, -701.057, 1167.26, -1111.92, 615.364, -183.854, 22.8595, 0},
              {-19.7415, 454.317, -1250.51, 1512.52, -762.408, 137.695, 0, 0, 0},
              {-55.9612, 657.449, -2049.73, 3295.30, -2995.85, 1553.68, -427.764, 48.4324, 0},
              {-522.682, 3356.77, -7535.50, 8756.49, -5518.61, 1795.60, -235.144, 0, 0}},
                 {{61.1474, -88.7680, 82.6446, -36.2780, 5.92310, 0, 0, 0, 0},
              {73.7620, -34.6321, -41.8796, 117.543, -81.2043, 17.1718, 0, 0, 0},
              {-82.0368, 883.261, -2828.84, 4621.53, -4223.56, 2185.52, -598.218, 67.2908, 0},
              {608.323, -2743.56, 4942.01, -4045.58, 1558.07, -226.240, 0, 0, 0},
              {4.07203, 138.882, -321.983, 282.702, -12.9566, -129.159, 74.5884, -12.9994, 0},
              {-866.737, 5984.13, -15129.6, 19134.6, -12757.7, 4276.79, -566.056, 0, 0}}};

   const Float_t fgPar_2GeV_2250_EfidTheta_S3[4][8] = {{74.4893, -158.720, 251.241, -200.000, 52.2984, 25.4188, -18.8692, 3.27217},
                 {90.8413, -226.800, 358.487, -259.260, 30.9359, 68.7248, -38.9760, 6.47933},
                 {117.102, -429.455, 1208.29, -1922.72, 1791.40, -965.135, 277.459, -32.8536},
                 {55.0676, 91.0959, -444.252, 791.284, -717.492, 350.325, -87.3235, 8.68087}};

   const Float_t fgPar_2GeV_2250_EfidTheta_S4[2][8] = {{77.7940, -192.492, 361.852, -394.127, 246.499, -84.6133, 13.9182, -0.713846},
                 {41.2902, 110.603, -586.690, 1130.70, -1137.27, 633.345, -185.038, 22.1482}};

   const Float_t fgPar_2GeV_2250_EfidTheta_S5[8][8] = {{-12998.3, 57694.0, -109085, 114102, -71303.6, 26616.9, -5494.45, 483.756},
                 {17842.9, -74659.9, 133869, -133170, 79380.0, -28352.3, 5617.88, -476.314},
                 {65.5364, -99.8689, 88.5645, 24.8299, -121.327, 102.818, -37.8275, 5.28492},
                 {66.4049, -76.4096, -20.8674, 230.072, -318.905, 206.721, -66.3286, 8.48753},
                 {100.262, -358.882, 957.267, -1495.42, 1396.73, -765.881, 226.791, -27.9341},
                 {50.4447, 48.3032, -315.976, 580.141, -525.583, 252.075, -59.9294, 5.34805},
                 {78.5845, -155.728, 320.528, -420.296, 341.899, -164.626, 42.5274, -4.50224},
                 {95.9430, -221.787, 391.495, -350.033, 131.391, 13.2965, -24.0460, 4.92253}};

   const Float_t fgPar_2GeV_2250_Pfid_For[6][4][7] =  {{{60.2165, -189.720, 446.990, -523.122, 320.721, -97.8518, 11.5258},
                  {-1457.16, 13814.2, -43182.7, 66646.0, -54355.1, 22423.5, -3683.76},
                  {17.1086, 54.2974, -103.464, 111.325, -70.7673, 27.2551, -5.02858},
                  {-2547.86, 22143.1, -66326.6, 101105.0, -82187.8, 33959.7, -5607.59}},
                 {{65.7242, -246.922, 759.745, -1198.32, 1007.05, -428.060, 72.2644},
                  {3384.16, -19353.1, 54083.5, -79843.4, 63870.2, -26079.2, 4250.29},
                  {85.2489, -441.821, 1327.52, -1978.53, 1567.84, -633.530, 102.928},
                  {411.998, -533.572, 599.925, 2099.52, -5061.48, 3701.58, -891.843}},
                 {{110.022, -558.044, 1512.96, -2098.53, 1579.55, -613.478, 96.3279},
                  {3937.29, -23745.1, 59651.0, -76988.6, 54276.0, -19900.2, 2974.95},
                  {35.8488, -46.9595, 107.492, -93.9141, 10.5845, 26.1910, -9.89460},
                  {-326.838, 4634.99, -11155.2, 11811.4, -5405.80, 554.030, 175.526}},
                 {{38.9338, -62.8663, 118.218, -56.6953, -40.5083, 46.1782, -11.5822},
                  {1864.83, -11735.6, 34175.4, -48928.5, 37315.8, -14496.1, 2254.05},
                  {23.6892, 9.69854, 94.4521, -270.119, 288.132, -140.031, 25.9272},
                  {-261.086, 4863.13, -11760.4, 13791.1, -8983.19, 3136.52, -457.183}},
                 {{-11.0252, 348.901, -1172.63, 1980.73, -1759.08, 786.043, -139.299},
                  {-2231.41, 23477.1, -78229.3, 129238.0, -111761.0, 48561.4, -8370.65},
                  {104.415, -548.464, 1506.70, -2064.10, 1507.55, -561.677, 83.9247},
                  {1402.87, -9008.78, 25660.0, -37543.3, 29860.8, -12238.4, 2019.03}},
                 {{20.4577, 66.1373, -205.218, 372.864, -366.625, 177.596, -33.1168},
                  {2059.77, -14468.3, 46492.9, -72168.2, 58275.9, -23615.8, 3800.60},
                  {-18.9897, 392.519, -1234.31, 1950.24, -1623.01, 681.260, -113.806},
                  {-3478.50, 32840.9, -104381.0, 167656.0, -143070.0, 61909.3, -10690.1}}};

   const Float_t fgPar_2GeV_2250_Pfid_Bak[6][4][7] = {{{110.007, 121.302, 97.8380, -1679.71, 4022.73, -3973.09, 1422.42},
                 {69.7305, 359.843, -876.383, 649.612, 600.059, -1155.43, 472.866},
                 {13.9334, -236.587, 810.783, -1614.65, 1851.97, -1125.48, 280.069},
                 {10.1644, 51.7943, -527.843, 2071.12, -3480.34, 2663.52, -768.498}},
                {{161.555, -263.801, 770.924, -902.814, 503.641, -319.619, 171.147},
                 {154.660, -619.711, 3444.65, -8994.29, 12253.9, -8439.82, 2321.14},
                 {117.461, -1429.96, 6117.79, -13492.3, 16142.2, -9965.40, 2490.47},
                 {7.77411, -17.3501, 279.462, -876.326, 1398.82, -1137.49, 365.383}},
                {{-31.1460, 1942.49, -9193.97, 21731.0, -26961.3, 16701.7, -4067.85},
                 {154.660, -654.420, 3774.08, -9920.36, 13333.7, -8953.68, 2386.32},
                 {63.2709, -867.859, 4000.97, -9557.57, 12215.1, -7926.91, 2052.90},
                 {-28.1127, 484.636, -2665.71, 7484.94, -10740.7, 7561.79, -2076.70}},
                {{172.853, -656.312, 3768.76, -10243.0, 14600.3, -10616.3, 3095.27},
                 {270.076, -1938.46, 9276.01, -21861.1, 27363.7, -17479.9, 4490.05},
                 {32.2327, -432.593, 1666.57, -3491.43, 4031.58, -2406.30, 579.944},
                 {-44.9153, 638.112, -2971.77, 7223.13, -9328.99, 6080.46, -1576.13}},
                {{45.7403, 875.133, -3646.85, 7848.52, -8905.36, 4914.78, -1010.91},
                 {138.000, -449.485, 2806.13, -7725.44, 10777.3, -7482.95, 2056.80},
                 {72.7551, -944.002, 4200.92, -9776.76, 12316.6, -7955.78, 2066.50},
                 {-9.59531, 180.519, -795.797, 2124.85, -2978.29, 2040.14, -541.811}},
                {{77.5100, 494.571, -1625.99, 2397.48, -1177.99, -574.604, 530.446},
                 {117.869, -56.8761, 330.252, -715.276, 807.257, -497.124, 133.989},
                 {7.66164, -208.001, 996.883, -2772.33, 4100.81, -3008.90, 864.126},
                 {-25.3497, 346.501, -1458.46, 3513.62, -4625.70, 3088.01, -818.696}}};

   const Float_t fgPar_2GeV_2250_Pfid_ScpdS2[2][6] = {{-28.1486, 425.124, -935.693, 1065.39, -608.526, 137.658},
                {-15.2084, 345.466, -697.657, 751.738, -419.288, 95.2206}};

   const Float_t fgPar_2GeV_2250_Pfid_ScpdS3[8][6] = {{17.1490, 294.605, -640.590, 707.758, -386.730, 83.2529},
                {35.9318, 204.580, -404.489, 413.240, -209.580, 41.7819},
                {47.6825, 274.777, -754.725, 1117.80, -846.816, 255.607},
                {44.7484, 344.543, -872.200, 1113.89, -694.736, 168.061},
                {-205.978, 828.617, -1199.65, 875.482, -317.846, 45.6938},
                {-240.595, 961.068, -1370.34, 977.625, -345.743, 48.3834},
                {-136.104, 479.276, -593.135, 374.730, -118.350, 14.7923},
                {-196.773, 700.974, -894.540, 577.460, -185.690, 23.6201}};

   const Float_t fgPar_2GeV_2250_Pfid_ScpdS4[4][6] = {{81.8115, 139.810, -445.130, 804.212, -821.194, 364.924},
                {79.5053, 317.287, -1582.80, 3987.05, -4880.55, 2305.63},
                {-137.480, 633.288, -954.383, 721.057, -269.140, 39.4822},
                {-145.605, 697.662, -1088.74, 853.855, -330.883, 50.3421}};

   const Float_t fgPar_2GeV_2250_Pfid_ScpdS5[8][6] = {{-29.9426, 370.963, -714.697, 707.343, -348.995, 67.7647},
                {-27.4173, 372.536, -693.341, 652.792, -302.559, 54.7761},
                {-47.1617, 132.967, -104.776, 41.7673, -7.68238, 0.404311},
                {-54.5895, 149.685, -111.590, 41.2556, -6.93943, 0.301087},
                {-79.1386, 275.678, -341.972, 218.907, -69.5520, 8.66381},
                {-97.5794, 352.616, -468.487, 322.829, -111.159, 15.0975},
                {22.5823, -182.064, 365.317, -294.653, 108.779, -15.2712},
                {-7.59521, 2.91795, 31.6773, -28.3085, 10.5943, -1.57966}};

};
#endif
